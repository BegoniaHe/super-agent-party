<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super API Party</title>
  <link rel="stylesheet" href="css/styles.css">
  <!-- GitHub Markdown CSS for styling -->
  <link rel="stylesheet" href="css/github-markdown.min.css">
  <!-- Highlight.js CSS for code highlighting -->
  <link rel="stylesheet" href="css/github.min.css">
  <script src="js/clipboard.min.js"></script>
  <!-- 引入Element Plus样式 -->
  <link rel="stylesheet" href="node_modules/element-plus/dist/index.css">
  <link rel="icon" href="data:,">
</head>
<body>
  <div id="app">
    <!-- 顶部栏 -->
    <el-header v-if="isElectron" class="top-bar" height="30px">
      <div class="window-controls">
        <el-button @click="minimizeWindow" class="top-bar-btn" text>
          <el-icon><Minus /></el-icon>
        </el-button>
        <el-button @click="maximizeWindow" class="top-bar-btn" text>
          <el-icon><Expand /></el-icon>
        </el-button>
        <el-button @click="closeWindow" class="top-bar-btn" text>
          <el-icon><Close /></el-icon>
        </el-button>
      </div>
    </el-header>    

    <!-- 主容器 -->
    <el-container class="main-container">
      <!-- 侧边栏 -->
      <el-aside :width="isCollapse ? '64px' : '200px'" class="sidebar">
        <el-menu
          :collapse="isCollapse"
          :default-active="activeMenu"
          class="el-menu-vertical"
          @select="handleSelect">
          <el-menu-item index="home">
            <el-icon><chat-dot-square /></el-icon>
            <template #title>对话</template>
          </el-menu-item>
          <el-menu-item index="settings">
            <el-icon><cpu /></el-icon>
            <template #title>主模型</template>
          </el-menu-item>
          <el-menu-item index="reasoner">
            <el-icon><magic-stick /></el-icon>
            <template #title>推理模型</template>
          </el-menu-item>
          <el-menu-item index="websearch">
            <el-icon><search /></el-icon>
            <template #title>联网搜索</template>
          </el-menu-item>
          <el-menu-item index="tools">
            <el-icon><tools /></el-icon>
            <template #title>工具</template>
          </el-menu-item>
          <el-menu-item index="api">
            <el-icon><connection /></el-icon>
            <template #title>API</template>
          </el-menu-item>
          <el-menu-item index="web">
            <el-icon><compass /></el-icon>
            <template #title>浏览器模式</template>
          </el-menu-item>
        </el-menu>
      </el-aside>

      <!-- 内容区 -->
      <el-main class="content">
        <!-- 聊天界面保持不变 -->
        <div v-show="activeMenu === 'home'" class="page chat-container">
          <!-- 聊天消息列表 -->
          <div class="messages-container" ref="messagesContainer">
            <div v-for="(message, index) in messages" :key="index" class="message" :class="message.role">
              <div class="message-content">
                <!-- 用户消息内容 -->
                <div v-if="message.role === 'user'" class="user-message-content">
                  <div v-html="message.content"></div>
                  <!-- 文件链接展示 -->
                  <div v-if="message.fileLinks?.length" class="file-links">
                    <a
                      v-for="(link, linkIndex) in message.fileLinks"
                      :key="linkIndex"
                      :href="link.path"
                      target="_blank"
                      class="file-link"
                    >
                      @{{ link.name }}
                    </a>
                  </div>
                </div>
                <!-- AI回复内容 -->
                <div v-else class="markdown-body" v-html="formatMessage(message.content)"></div>

              </div>
            </div>
          </div>
            <!-- 文件上传对话框 -->
            <el-dialog 
              v-model="showUploadDialog" 
              title="上传文件" 
              width="30%"
              :before-close="() => showUploadDialog = false">
              
              <div class="upload-container">
                <!-- 可点击的拖拽区域 -->
                <div 
                  class="drop-zone"
                  @dragover.prevent
                  @drop.prevent="handleDrop"
                  @click="browseFiles"
                >
                  <el-icon :size="50"><upload /></el-icon>
                  <p>点击或拖放文件到此区域</p>
                </div>
              </div>
            </el-dialog>
            <div class="button-group">
              <el-button 
                @click="clearMessages" 
                class="icon-btn clear-btn" 
                :icon="'Delete'" 
                circle>
              </el-button>
              <el-button 
                @click="sendFiles" 
                class="icon-btn file-btn" 
                :icon="'DocumentAdd'" 
                circle>
              </el-button>
              <el-button 
                @click="sendMessage" 
                class="icon-btn send-btn" 
                :icon="'Promotion'" 
                circle>
              </el-button>
            </div>                  
              <div class="input-container">
                <!-- 紧凑型文件列表 -->
                <div class="compact-file-list" v-if="files.length">
                  <div v-for="(file, index) in files" :key="index" class="compact-file-item">
                    <span class="file-name">@{{ file.name }}</span>
                    <el-button 
                      @click.stop="removeFile(index)"
                      class="delete-icon" 
                      :icon="'delete'" 
                      circle
                    />
                  </div>
                </div>
                <el-input
                  v-model="userInput"
                  type="textarea"
                  :rows="4"
                  placeholder="输入消息..."
                  resize="none"
                  @keydown="handleKeydown"
                />
              </div>
        </div>

        <!-- 工具界面 -->
        <div v-show="activeMenu === 'tools'" class="page tools-container">
          <el-form :model="toolsSettings" class="settings-form">
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('time')">
                <span>
                  <el-icon><timer /></el-icon>
                  当前时间
                </span>
                <el-switch v-model="toolsSettings.time.enabled" @click.stop @change="autoSaveSettings"/>
              </div>
            </div>
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('inference')">
                <span>
                  <el-icon><reading-lamp /></el-icon>
                  伪推理
                </span>
                <el-switch v-model="toolsSettings.inference.enabled" @click.stop @change="autoSaveSettings"/>
              </div>
            </div>
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('language')">
                <span>
                  <el-icon><comment /></el-icon>
                  语言语气
                </span>
                <el-switch v-model="toolsSettings.language.enabled" @click.stop @change="autoSaveSettings"/>
              </div>
              <div class="tool-content" v-show="expandedSections.language">
                <el-form-item label="助手语言" class="form-item-align">
                  <el-select 
                    v-model="toolsSettings.language.language" 
                    @change="autoSaveSettings"
                    class="full-width-input"
                  >
                    <!--从languageOptions中动态加载-->
                    <el-option v-for="option in languageOptions" :key="option.value" :label="option.label" :value="option.value"></el-option>
                  </el-select>
                </el-form-item>
                <el-form-item label="助手语气" class="form-item-align">
                  <el-select 
                    v-model="toolsSettings.language.tone" 
                    @change="autoSaveSettings"
                    class="full-width-input"
                  >
                     <!--从toneOptions中动态加载-->
                    <el-option v-for="option in toneOptions" :key="option.value" :label="option.label" :value="option.value"></el-option>
                  </el-select>
                </el-form-item>
              </div>
            </div>
          </el-form>
        </div>

        <!-- 联网搜索界面 -->
        <div v-show="activeMenu === 'websearch'" class="page tools-container">
          <el-form :model="webSearchSettings" class="settings-form">
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('webSearchConfig')">
                <div class="header-left">
                  <span>
                    <el-icon><search /></el-icon>
                    联网搜索
                  </span>
                </div>
                <el-switch v-model="webSearchSettings.enabled" @click.stop @change="autoSaveSettings"/>
              </div>
              <div class="tool-content" v-show="expandedSections.webSearchConfig">
                <el-form-item label="搜索引擎" class="form-item-align">
                  <el-select 
                    v-model="webSearchSettings.engine" 
                    @change="autoSaveSettings"
                    class="full-width-input"
                  >
                    <el-option label="DuckDuckGo" value="duckduckgo" ></el-option>
                    <el-option label="SearXNG" value="searxng" ></el-option>
                    <el-option label="tavily" value="tavily" ></el-option>
                  </el-select>
                </el-form-item>
                <el-form-item label="联网时机" class="form-item-align">
                  <el-select 
                    v-model="webSearchSettings.when" 
                    @change="autoSaveSettings"
                    class="full-width-input"
                  >
                    <el-option label="思考前" value="before_thinking" ></el-option>
                    <el-option label="思考后" value="after_thinking" ></el-option>
                    <el-option label="两者都" value="both" ></el-option>
                  </el-select>
                </el-form-item>
              </div>
            </div>
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('duckduckgoConfig')">
                <div class="header-left">
                  <span>
                    <el-icon><search /></el-icon>
                    DuckDuckGo
                  </span>
                </div>
              </div>
              <div class="tool-content" v-show="expandedSections.duckduckgoConfig">
                <el-form-item label="结果数量" class="form-item-align">
                  <el-slider
                    v-model="webSearchSettings.duckduckgo_max_results"
                    :min="1"
                    :max="50"
                    :step="1"
                    @input="autoSaveSettings"
                  />
                </el-form-item>
              </div>
            </div>
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('searxngConfig')">
                <div class="header-left">
                  <span>
                    <el-icon><search /></el-icon>
                    SearXNG
                  </span>
                </div>
              </div>
              <div class="tool-content" v-show="expandedSections.searxngConfig">
                <el-form-item label="结果数量" class="form-item-align">
                  <el-slider
                    v-model="webSearchSettings.searxng_max_results"
                    :min="1"
                    :max="50"
                    :step="1"
                    @input="autoSaveSettings"
                  />
                </el-form-item>
                <el-form-item label="基础URL" class="form-item-align">
                  <el-input 
                    v-model="webSearchSettings.searxng_url" 
                    placeholder="SearXNG URL"
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
              </div>
            </div>
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('tavilyConfig')">
                <div class="header-left">
                  <span>
                    <el-icon><search /></el-icon>
                    Tavily
                  </span>
                </div>
              </div>
              <div class="tool-content" v-show="expandedSections.tavilyConfig">
                <el-form-item label="结果数量" class="form-item-align">
                  <el-slider
                    v-model="webSearchSettings.tavily_max_results"
                    :min="1"
                    :max="50"
                    :step="1"
                    @input="autoSaveSettings"
                  />
                </el-form-item>
                <el-form-item label="API Key" class="form-item-align">
                  <el-input 
                    v-model="webSearchSettings.tavily_api_key" 
                    placeholder="tavily API 密钥"
                    show-password
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
              </div>
            </div>
          </el-form>
        </div>
        <!-- API列表 -->
        <!-- 修改后的API列表界面 -->
        <div v-show="activeMenu === 'api'" class="page tools-container">
          <el-form class="settings-form">
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('superapi')">
                  <span>
                    <el-icon><key /></el-icon>
                    使用Super API
                  </span>
              </div>
              <div class="tool-content" v-show="expandedSections.superapi">
                <!-- 模型名称 -->
                <el-form-item label="模型名称" class="form-item-align">
                  <el-input 
                    :value="'super-model'" 
                    readonly 
                    class="full-width-input"
                  >
                    <template #append>
                      <el-button 
                        @click="copyModel"
                        :icon="'document-copy'"
                        class="copy-btn"
                      />
                    </template>
                  </el-input>
                </el-form-item>

                <!-- API端点 -->
                <el-form-item label="API 端点" class="form-item-align">
                  <el-input 
                    :value="'http://127.0.0.1:3456/v1'" 
                    readonly 
                    class="full-width-input"
                  >
                    <template #append>
                      <el-button 
                        @click="copyEndpoint"
                        :icon="'document-copy'"
                        class="copy-btn"
                      />
                    </template>
                  </el-input>
                </el-form-item>
                <!-- 在index.html的API配置区块内添加 -->
                <el-form-item label="示例语言" class="form-item-align">
                  <el-select 
                    v-model="selectedCodeLang" 
                    @change="autoSaveSettings"
                    class="full-width-input"
                  >
                    <el-option label="Python" value="python"></el-option>
                    <el-option label="JavaScript" value="javascript"></el-option>
                    <el-option label="cURL" value="curl"></el-option>
                  </el-select>
                </el-form-item>

                <!-- 修改index.html中的代码块结构 -->
                <div class="code-block">
                  <div class="code-header">
                    <span class="code-lang">{{ selectedCodeLang }}</span>
                    <button class="copy-button" @click.prevent="handleCopy">复制</button>
                  </div>
                  <pre><code class="hljs" :class="'language-' + selectedCodeLang">{{ codeExamples[selectedCodeLang] }}</code></pre>
                </div>
              </div>
            </div>
          </el-form>
        </div>


        <!-- 主模型界面 -->
        <!-- 修改后的主模型界面 -->
        <div v-show="activeMenu === 'settings'" class="page tools-container">
          <el-form :model="settings" class="settings-form">
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('settingsBase')">
                <div class="header-left">
                  <span>
                    <el-icon><trophy-base /></el-icon>
                    基础配置
                  </span>
                </div>
              </div>
              <div class="tool-content" v-show="expandedSections.settingsBase">
                <el-form-item label="模型名称" class="form-item-align">
                  <el-input 
                    v-model="settings.model" 
                    placeholder="模型名称"
                    @input="autoSaveSettings" 
                    class="full-width-input"
                  />
                </el-form-item>
                <el-form-item label="基础URL" class="form-item-align">
                  <el-input 
                    v-model="settings.base_url" 
                    placeholder="基础URL"
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
                <el-form-item label="API密钥" class="form-item-align">
                  <el-input 
                    v-model="settings.api_key" 
                    placeholder="API密钥" 
                    show-password
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
              </div>
            </div>

            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('settingsAdvanced')">
                <div class="header-left">
                  <span>
                    <el-icon><coffee-cup /></el-icon>
                    高级设置
                  </span>
                </div>
              </div>
              <div class="tool-content" v-show="expandedSections.settingsAdvanced">
                <el-form-item label="温度" class="form-item-align">
                  <el-slider
                    v-model="settings.temperature"
                    :min="0"
                    :max="1"
                    :step="0.1"
                    @input="autoSaveSettings"
                  />
                </el-form-item>
                <el-form-item label="输出长度" class="form-item-align">
                  <el-slider
                    v-model="settings.max_tokens"
                    :min="0"
                    :max="128000"
                    :step="1024"
                    @input="autoSaveSettings"
                  />
                </el-form-item>
                <el-form-item label="对话轮数" class="form-item-align">
                  <el-slider
                    v-model="settings.max_rounds"
                    :min="0"
                    :max="1000"
                    :step="2"
                    @input="autoSaveSettings"
                  />
                </el-form-item>
              </div>
            </div>
          </el-form>
        </div>

        <!-- 推理模型界面 -->
        <div v-show="activeMenu === 'reasoner'" class="page tools-container">
          <el-form :model="settings" class="settings-form">
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('reasonerConfig')">
                <div class="header-left">
                  <span>
                    <el-icon><reading-lamp /></el-icon>
                    推理配置
                  </span>
                </div>
                <el-switch v-model="reasonerSettings.enabled" @click.stop @change="autoSaveSettings"/>
              </div>
              <div class="tool-content" v-show="expandedSections.reasonerConfig">        
                <el-form-item label="模型名称" class="form-item-align">
                  <el-input 
                    v-model="reasonerSettings.model" 
                    placeholder="模型名称"
                    @input="autoSaveSettings" 
                    class="full-width-input"
                  />
                </el-form-item>
                <el-form-item label="基础URL" class="form-item-align">
                  <el-input 
                    v-model="reasonerSettings.base_url" 
                    placeholder="基础URL"
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
                <el-form-item label="API密钥" class="form-item-align">
                  <el-input 
                    v-model="reasonerSettings.api_key" 
                    placeholder="API密钥" 
                    show-password
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
              </div>
            </div>
          </el-form>
        </div>
      </el-main>
    </el-container>
  </div>

  <!-- 引入Vue和Element Plus -->
  <script src="node_modules/vue/dist/vue.global.js"></script>
  <script src="node_modules/element-plus/dist/index.full.js"></script>
  <script src="node_modules/@element-plus/icons-vue/dist/index.iife.min.js"></script>
  <!-- Include markdown-it and highlight.js scripts -->
  <script src="js/markdown-it.min.js"></script>
  <script src="js/highlight.min.js"></script>
  <script src="js/renderer.js"></script>
</body>
</html>
