<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super Agent party</title>
  <link rel="stylesheet" href="css/styles.css">
  <!-- GitHub Markdown CSS for styling -->
  <link rel="stylesheet" href="css/github-markdown.min.css">
  <!-- Highlight.js CSS for code highlighting -->
  <link rel="stylesheet" href="css/github.min.css">
  <script src="js/clipboard.min.js"></script>
  <!-- 引入Element Plus样式 -->
  <link rel="stylesheet" href="node_modules/element-plus/dist/index.css">
  <link rel="stylesheet" href="fontawesome/css/all.min.css">
  <link rel="icon" href="source/icon.png" type="image/png">
  <!-- Include markdown-it and highlight.js scripts -->
  <script src="js/markdown-it.min.js"></script>
  <script src="js/highlight.min.js"></script>
  <script src="js/locales.js"></script>
  <script src="js/mermaid.min.js"></script>
  <script src="js/uuid.min.js"></script>
  <script>
    mermaid.initialize({ 
      startOnLoad: false,
      securityLevel: 'loose',
      theme: 'default',
    });
  </script>
  <!--  MathJax 配置  -->
  <script>
    window.MathJax = {
      options: {
        ignoreHtmlClass: 'user-message-content'  // 匹配用户消息容器类名
      },
      tex: {
        inlineMath: [
          ['$', '$']       // 常见的行内公式定界符
        ],
        displayMath: [
          ['$$', '$$']     // 常见的行间公式定界符
        ],
      },
      svg: {
        fontCache: 'global' // 使用全局字体缓存
      },
      startup: {
        pageReady: () => {
          // 可选：页面加载完成后执行一些操作
          console.log("MathJax is ready!");
        }
      }
    };
  </script>
  <script id="MathJax-script" async src="js/tex-svg.js"></script>
</head>
<body>
  <div id="app">
    <!-- 顶部栏 -->
    <el-header v-if="isElectron" class="top-bar" height="30px">
      <div class="window-controls">
        <el-button 
          v-if="updateAvailable"
          @click="handleUpdate" 
          class="top-bar-btn update-btn"
          :class="{ 'success': updateSuccess }"
          text>
          <el-icon>
            <i class="fa-solid fa-download"></i>
          </el-icon>
          {{ updateSuccess ? t('updateSuccess') : t('updateAvailable') }}
        </el-button>
        <el-button @click="minimizeWindow" class="top-bar-btn" text>
          <el-icon>
            <i class="fa-solid fa-minus"></i>
          </el-icon>
        </el-button>
        <el-button @click="toggleIcon" class="top-bar-btn" text>
          <el-icon>
            <i :class="iconClass"></i>
          </el-icon>
        </el-button>
        <el-button @click="closeWindow" class="top-bar-btn" text>
          <el-icon>
            <i class="fa-solid fa-xmark"></i>
          </el-icon>
        </el-button>
      </div>
    </el-header>

    <!-- 主容器 -->
    <el-container class="main-container">
      <!-- 侧边栏 -->
      <el-aside :width="isCollapse ? '64px' : '200px'" class="sidebar">
        <el-menu
          :collapse="isCollapse"
          :default-active="activeMenu"
          class="el-menu-vertical"
          @select="handleSelect">
          <el-menu-item index="home">
            <el-icon>
              <i class="fa-solid fa-comment"></i>
            </el-icon>
            <template #title>{{ t('chat') }}</template>
          </el-menu-item>
          <el-menu-item index="settings">
            <el-icon>
              <i class="fa-solid fa-microchip"></i>
            </el-icon>
            <template #title>{{ t('mainModel') }}</template>
          </el-menu-item>
          <el-menu-item index="agents">
            <el-icon>
              <i class="fa-solid fa-robot"></i>
            </el-icon>
            <template #title>{{ t('agents') }}</template>
          </el-menu-item>
          <el-menu-item index="tools">
            <el-icon>
              <i class="fa-solid fa-screwdriver-wrench"></i>
            </el-icon>
            <template #title>{{ t('tools') }}</template>
          </el-menu-item>
          <el-menu-item index="reasoner">
            <el-icon>
              <i class="fa-solid fa-atom"></i>
            </el-icon>
            <template #title>{{ t('reasoner') }}</template>
          </el-menu-item>
          <el-menu-item index="websearch">
            <el-icon>
              <i class="fa-solid fa-globe"></i>
            </el-icon>
            <template #title>{{ t('webSearch') }}</template>
          </el-menu-item>
          <el-menu-item index="document">
            <el-icon>
              <i class="fa-solid fa-book"></i>
            </el-icon>
            <template #title>{{ t('knowledgeBase') }}</template>
          </el-menu-item>
          <el-menu-item index="llmTool">
            <el-icon>
              <i class="fa-solid fa-network-wired"></i>
            </el-icon>
            <template #title>{{ t('llmTool') }}</template>
          </el-menu-item>
          <el-menu-item index="mcp">
            <el-icon>
              <i class="fa-solid fa-server"></i>
            </el-icon>
            <template #title>{{ t('mcpServers') }}</template>
          </el-menu-item>
          <el-menu-item index="a2a">
            <el-icon>
              <i class="fa-solid fa-plug"></i>
            </el-icon>
            <template #title>{{ t('a2aServers') }}</template>
          </el-menu-item>
          <el-menu-item index="api-box">
            <el-icon>
              <i class="fa-solid fa-cloud"></i>
            </el-icon>
              <template #title>{{ t('modelService') }}</template>
          </el-menu-item>
          <el-menu-item index="api">
            <el-icon>
              <i class="fa-solid fa-key"></i>
            </el-icon>
            <template #title>{{ t('callingMethod') }}</template>
          </el-menu-item>
          <el-menu-item index="system">
            <el-icon>
              <i class="fa-solid fa-gear"></i>
            </el-icon>
            <template #title>{{ t('systemSettings') }}</template>
          </el-menu-item>
          <el-menu-item 
            index="logo"
            class="sidebar-logo">
            <el-icon class="logo-icon"><img src="./source/icon.png" /></el-icon>
            <template #title>{{ t('aboutUs') }}</template>
          </el-menu-item>
        </el-menu>
      </el-aside>

      <!-- 内容区 -->
      <el-main class="content">
        <!-- 聊天界面保持不变 -->
        <div v-show="activeMenu === 'home'" class="page chat-container">
          <!-- 聊天消息列表 -->
          <div class="messages-container" ref="messagesContainer">
            <div v-for="(message, index) in messages" :key="index" class="message" :class="message.role">
              <div class="message-content">
                <!-- 用户消息内容 -->
                <div v-if="message.role === 'user'" class="user-message-content" data-mjx-disabled="true">
                  <div v-html="message.content"></div>
                  <!-- 文件链接展示 -->
                  <div v-if="message.fileLinks?.length" class="file-links">
                    <a
                      v-for="(link, linkIndex) in message.fileLinks"
                      :key="linkIndex"
                      :href="link.path"
                      target="_blank"
                      class="file-link"
                    >
                      @{{ link.name }}
                    </a>
                  </div>
                </div>
                <!-- AI回复内容 -->
                <div v-else class="markdown-body" v-html="formatMessage(message.content)"></div>

              </div>
            </div>
          </div>
            <!-- 文件上传对话框 -->
            <el-dialog
              v-model="showUploadDialog"
              :title="t('uploadFile')"
              width="30%"
              :before-close="() => showUploadDialog = false">

              <div class="upload-container">
                <!-- 可点击的拖拽区域 -->
                <div
                  class="drop-zone"
                  @dragover.prevent
                  @drop.prevent="handleDrop"
                  @click="browseFiles"
                >
                  <el-icon :size="50"><upload /></el-icon>
                  <p>{{ t('clickOrDrop') }}</p>
                </div>
              </div>
            </el-dialog>
            <el-dialog
              v-model="showKnowledgeDialog"
              :title="t('knowledgeBaseSelection')"
              width="400px">
              <div class="knowledge-dialog-content">
                <div v-for="kb in knowledgeBases" :key="kb.id" class="knowledge-item">
                  <el-switch v-model="kb.enabled" @change="autoSaveSettings"></el-switch>
                  <div class="knowledge-info">
                    <div class="knowledge-name">{{ kb.name }}</div>
                    <div class="knowledge-desc">{{ kb.introduction || t('noDescription') }}</div>
                  </div>
                </div>
                <div v-if="knowledgeBases.length === 0" class="empty-tip">
                  {{ t('noKnowledgeBase') }}
                  <a href="#" @click.stop.prevent="switchToKnowledgePage">{{ t('goToKnowledgeBase') }}</a>
                  {{ t('add') }}
                </div>
              </div>
            </el-dialog>
          <el-dialog
            v-model="showAgentDialog"
            :title="t('agentSettings')"
            width="500px">
            <div class="agent-dialog-content">
              <!-- 主智能体选择 -->
              <div class="agent-section">
                <h3>{{ t('mainAgent') }}</h3>
                <el-select 
                  v-model="mainAgent"
                  @change="autoSaveSettings">
                  <el-option
                    :label="t('defaultAgent')"
                    value="super-model"
                  >
                  </el-option>
                  <el-option
                    v-for="(agent, id) in agents"
                    :key="id"
                    :label="agent.name"
                    :value="id"
                  >
                  </el-option>
                </el-select>
              </div>
              <!-- 工具智能体选择 -->
              <div class="agent-section">
                <h3>{{ t('toolAgents') }}</h3>
                <div 
                  v-for="(agent, id) in agents" 
                  :key="id"
                  class="knowledge-item">
                  <el-switch 
                    v-model="agent.enabled"
                    @change="autoSaveSettings">
                  </el-switch>
                  <div class="knowledge-info">
                    <div class="knowledge-name">{{ agent.name }}</div>
                  </div>
                </div>
                <div v-if="Object.keys(agents).length === 0" class="empty-tip">
                  {{ t('noagents') }}
                  <a href="#" @click.stop.prevent="switchToagents">{{ t('goToagents') }}</a>
                  {{ t('add') }}
                </div>
              </div>
            </div>
          </el-dialog>
          <el-dialog
            v-model="showMCPServerDialog"
            :title="t('mcpServersManagement')"
            width="400px">
            <div class="knowledge-dialog-content">
              <!-- 服务器列表 -->
              <div v-for="(server, name) in mcpServers" :key="name" class="knowledge-item">
                <el-switch 
                  :active-value="false"  
                  :inactive-value="true" 
                  v-model="server.disabled" 
                  @change="autoSaveSettings">
                </el-switch>
                <div class="knowledge-info">
                  <div class="knowledge-name">{{ name }}</div>
                </div>
              </div>
              <div v-if="Object.keys(mcpServers).length === 0" class="empty-tip">
                {{ t('nomcpServers') }}
                <a href="#" @click.stop.prevent="switchTomcpServers">{{ t('goTomcpServers') }}</a>
                {{ t('add') }}
              </div>
            </div>
          </el-dialog>
          <el-dialog
            v-model="showA2AServerDialog"
            :title="t('a2aServersManagement')"
            width="400px">
            <div class="knowledge-dialog-content">
              <div v-for="(server, url) in a2aServers" :key="url" class="knowledge-item">
                <el-switch v-model="server.enabled" @change="autoSaveSettings"></el-switch>
                <div class="knowledge-info">
                  <div class="knowledge-name">{{ server.name }}</div>
                  <div class="knowledge-desc">{{ server.description }}</div>
                </div>
              </div>
              <div v-if="Object.keys(a2aServers).length === 0" class="empty-tip">
                {{ t('noA2AServers') }}
                <a href="#" @click.stop.prevent="switchToa2aServers">{{ t('addA2AServer') }}</a>
                {{ t('add') }}
              </div>
            </div>
          </el-dialog>
          <el-dialog
            v-model="showLLMToolsDialog"
            :title="t('llmToolsManagement')"
            width="400px">
            <div class="knowledge-dialog-content">
              <div v-for="(tool, index) in llmTools" :key="index" class="knowledge-item">
                <el-switch v-model="tool.enabled" @change="autoSaveSettings"></el-switch>
                <div class="knowledge-info">
                  <div class="knowledge-name">{{ tool.name }}</div>
                  <div class="knowledge-desc">{{ tool.description || t('noDescription') }}</div>
                </div>
                <el-button 
                  @click="removeLLMTool(index)" 
                  type="danger" 
                  circle 
                  size="small">
                  <i class="fa-solid fa-trash"></i>
                </el-button>
              </div>
              <div v-if="llmTools.length === 0" class="empty-tip">
                {{ t('noLLMTools') }}
                <a href="#" @click.stop.prevent="switchTollmTools">{{ t('gollmTools') }}</a>
                {{ t('add') }}
              </div>
            </div>
          </el-dialog>
          <el-dialog
            v-model="showHistoryDialog"
            :title="t('chatHistory')"
            width="400px">
            <div class="knowledge-dialog-content">
              <!-- 对话记录列表 -->
              <div v-for="conv in sortedConversations" 
                  :key="conv.id" 
                  class="knowledge-item"
                  @click="loadConversation(conv.id)">
                <el-button 
                  @click.stop="confirmDeleteConversation(conv.id)"
                  type="danger" 
                  circle 
                  size="small">
                  <i class="fa-solid fa-trash"></i>
                </el-button>
                <div class="knowledge-info">
                  <h3 class="knowledge-name">{{ conv.title || t('untitled') }}</h3>
                  <div class="knowledge-desc">
                    <el-icon class="meta-icon"><i class="fa-solid fa-message"></i></el-icon>
                    <span>{{ conv.messages?.length || 0 }} {{ t('messages') }}</span><br>
                    <el-icon class="meta-icon"><i class="fa-solid fa-clock"></i></el-icon>
                    <span>{{ formatDate(conv.timestamp) }}</span>
                  </div>
                </div>
              </div>
              <!-- 如果没有对话记录 -->
              <div v-if="Object.keys(conversations).length === 0" class="empty-tip">
                {{ t('noChatHistory') }}
              </div>
            </div>
          </el-dialog>
          <div class="button-group">
            <el-tooltip :content="t('clearChat')" placement="top">
              <el-button
                @click="clearMessages"
                class="icon-btn clear-btn"
                type="danger"
                circle>
                <i class="fa-solid fa-trash"></i>
              </el-button>
            </el-tooltip>

            <el-tooltip :content="t('chatHistory')" placement="top">
              <el-button
                @click="showHistoryDialog = true"
                class="icon-btn history-btn"
                :type="hasFiles ? 'primary' : 'default'"
                circle>
                <i class="fa-solid fa-clock-rotate-left"></i>
              </el-button>
            </el-tooltip>

            <el-tooltip :content="t('uploadFile')" placement="top">
              <el-button
                @click="sendFiles"
                class="icon-btn file-btn"
                :type="hasFiles ? 'primary' : 'default'"
                circle>
                <i class="fa-solid fa-paperclip"></i>
              </el-button>
            </el-tooltip>

            <el-tooltip :content="t('knowledgeBase')" placement="top">
              <el-button
                @click="showKnowledgeDialog = true"
                class="icon-btn knowledge-base-btn"
                :type="hasEnabledKnowledgeBases ? 'primary' : 'default'"
                circle>
                <i class="fa-solid fa-book"></i>
              </el-button>
            </el-tooltip>

            <el-tooltip :content="t('deepThinking')" placement="top">
              <el-button
                @click="reasonerSettings.enabled = !reasonerSettings.enabled; autoSaveSettings()"
                class="icon-btn deep-think-btn"
                :type="reasonerSettings.enabled ? 'primary' : 'default'"
                circle>
                <i class="fa-solid fa-atom"></i>
              </el-button>
            </el-tooltip>

            <el-tooltip :content="t('deepResearch')" placement="top">
              <el-button
                @click="toolsSettings.deepsearch.enabled = !toolsSettings.deepsearch.enabled; autoSaveSettings()"
                class="icon-btn deep-search-btn"
                :type="toolsSettings.deepsearch.enabled ? 'primary' : 'default'"
                circle>
                <i class="fa-solid fa-flask"></i>
              </el-button>
            </el-tooltip>

            <el-tooltip :content="t('webSearch')" placement="top">
              <el-button
                @click="webSearchSettings.enabled = !webSearchSettings.enabled; autoSaveSettings()"
                class="icon-btn web-search-btn"
                :type="webSearchSettings.enabled ? 'primary' : 'default'"
                circle>
                <i class="fa-solid fa-globe"></i>
              </el-button>
            </el-tooltip>

            <el-tooltip :content="t('agents')" placement="top">
              <el-button
                @click="showAgentDialog = true"
                class="icon-btn agent-btn"
                :type="hasAgentChanges ? 'primary' : 'default'"
                circle>
                <i class="fa-solid fa-robot"></i>
              </el-button>
            </el-tooltip>

            <el-tooltip :content="t('llmTools')" placement="top">
              <el-button
                @click="showLLMToolsDialog = true"
                class="icon-btn llm-tool-btn"
                :type="hasEnabledLLMTools ? 'primary' : 'default'"
                circle>
                <i class="fa-solid fa-network-wired"></i>
              </el-button>
            </el-tooltip>

            <el-tooltip :content="t('mcpServers')" placement="top">
              <el-button
                @click="showMCPServerDialog = true"
                class="icon-btn mcp-btn"
                :type="hasEnabledMCPServers ? 'primary' : 'default'"
                circle>
                <i class="fa-solid fa-server"></i>
              </el-button>
            </el-tooltip>

            <el-tooltip :content="t('a2aServers')" placement="top">
              <el-button
                @click="this.showA2AServerDialog = true"
                class="icon-btn a2a-btn"
                :type="hasEnabledA2AServers ? 'primary' : 'default'"
                circle>
                <i class="fa-solid fa-plug"></i>
              </el-button>
            </el-tooltip>

            <el-tooltip :content="isSending ? t('stopGenerating') : t('sendMessage')" placement="top">
              <el-button
                @click="isSending ? stopGenerate() : sendMessage()"
                :type="isSending ? 'danger' : 'primary'"
                class="icon-btn send-btn"
                circle>
                <i :class="isSending ? 'fa-solid fa-stop' : 'fa-solid fa-paper-plane'" aria-hidden="true"></i>
              </el-button>
            </el-tooltip>
          </div>
              <div class="input-container">
                <!-- 紧凑型文件列表 -->
                <div class="compact-file-list" v-if="files.length">
                  <div v-for="(file, index) in files" :key="index" class="compact-file-item">
                    <span class="file-name">@{{ file.name }}</span>
                    <el-button
                      @click.stop="removeFile(index)"
                      class="delete-icon"
                      circle
                    >
                    <i class="fa-solid fa-trash"></i>
                    </el-button>
                  </div>
                </div>
                <el-input
                  v-model="userInput"
                  type="textarea"
                  :rows="4"
                  :placeholder="t('inputMessage')"
                  resize="none"
                  @keydown="handleKeydown"
                />
              </div>
        </div>
        <!---- 智能体页面 ---->
        <div v-show="activeMenu === 'agents'" class="page agents-container">
          <div class="keybox-container">
            <!-- 磁贴网格 -->
            <div class="provider-grid">
              <!-- 已有智能体 -->
              <div class="provider-card agent-card" v-for="agent in agents" :key="agent.id">
                <div class="card-header">
                  <el-switch v-model="agent.enabled" @change="autoSaveSettings"></el-switch>
                  <div class="card-actions">
                    <!-- 更新删除按钮样式 -->
                    <el-button @click="removeAgent(agent.id)" type="danger" circle size="small">
                      <i class="fa-solid fa-trash"></i>
                    </el-button>
                  </div>
                </div>
                
                <div class="agent-content">
                  <div class="agent-header">
                    <span class="agent-name">{{ agent.name }}</span>
                  </div>
                  <!-- 带复制功能的ID展示 -->
                  <el-tag 
                    type="info" 
                    size="mini" 
                    class="agent-id clickable"
                    @click="copyAgentId(agent.id)"
                  >
                    {{ agent.id }}
                    <i class="fa-regular fa-copy"></i>
                  </el-tag>
                  <p class="agent-prompt">{{ agent.system_prompt }}</p>
                </div>
              </div>
              <!-- 添加新智能体 -->
              <div class="provider-card add-tile" @click="showAgentForm = true">
                <el-icon :size="40" color="#909399"><i class="fa-solid fa-plus"></i></el-icon>
                <div style="color: #606266; margin-top: 10px;">{{ t('addNewAgent') }}</div>
              </div>
            </div>
            <!-- 智能体编辑对话框 -->
            <el-dialog v-model="showAgentForm" :title="editingAgent ? t('editAgent') : t('addAgent')" width="600px">
              <el-form label-position="top">
                <el-form-item :label="t('agentName')" required>
                  <el-input v-model="newAgent.name" :placeholder="t('agentNamePlaceholder')"/>
                </el-form-item>
                <el-form-item :label="t('systemPrompt')" required>
                  <el-input 
                    v-model="newAgent.system_prompt" 
                    type="textarea" 
                    :rows="6"
                    :placeholder="t('systemPromptPlaceholder')"/>
                </el-form-item>
                  <!-- 新增标签页 -->
                  <el-tabs v-model="agentTabActive" class="agent-config-tabs">
                    <!-- 知识库 -->
                    <el-tab-pane :label="t('knowledgeBase')" name="knowledge">
                      <div class="knowledge-dialog-content">
                        <div v-for="kb in knowledgeBases" :key="kb.id" class="knowledge-item">
                          <el-switch v-model="kb.enabled" @change="autoSaveSettings"></el-switch>
                          <div class="knowledge-info">
                            <div class="knowledge-name">{{ kb.name }}</div>
                            <div class="knowledge-desc">{{ kb.introduction || t('noDescription') }}</div>
                          </div>
                        </div>
                        <div v-if="knowledgeBases.length === 0" class="empty-tip">
                          {{ t('noKnowledgeBase') }}
                          <a href="#" @click.stop.prevent="switchToKnowledgePage">{{ t('goToKnowledgeBase') }}</a>
                          {{ t('add') }}
                        </div>
                      </div>
                    </el-tab-pane>
                    <!-- MCP服务器 -->
                    <el-tab-pane :label="t('mcpServers')" name="mcp">
                      <div class="knowledge-dialog-content">
                        <!-- 服务器列表 -->
                        <div v-for="(server, name) in mcpServers" :key="name" class="knowledge-item">
                          <el-switch 
                            :active-value="false"  
                            :inactive-value="true" 
                            v-model="server.disabled" 
                            @change="autoSaveSettings">
                          </el-switch>
                          <div class="knowledge-info">
                            <div class="knowledge-name">{{ name }}</div>
                          </div>
                        </div>
                        <div v-if="Object.keys(mcpServers).length === 0" class="empty-tip">
                          {{ t('nomcpServers') }}
                          <a href="#" @click.stop.prevent="switchTomcpServers">{{ t('goTomcpServers') }}</a>
                          {{ t('add') }}
                        </div>
                      </div>
                    </el-tab-pane>
                    <!-- A2A服务器 -->
                    <el-tab-pane :label="t('a2aServers')" name="a2a">
                      <div class="knowledge-dialog-content">
                        <div v-for="(server, url) in a2aServers" :key="url" class="knowledge-item">
                          <el-switch v-model="server.enabled" @change="autoSaveSettings"></el-switch>
                          <div class="knowledge-info">
                            <div class="knowledge-name">{{ server.name }}</div>
                            <div class="knowledge-desc">{{ server.description }}</div>
                          </div>
                        </div>
                        <div v-if="Object.keys(a2aServers).length === 0" class="empty-tip">
                          {{ t('noA2AServers') }}
                          <a href="#" @click.stop.prevent="switchToa2aServers">{{ t('addA2AServer') }}</a>
                          {{ t('add') }}
                        </div>
                      </div>
                    </el-tab-pane>
                    <!-- 工具 -->
                    <el-tab-pane :label="t('tools')" name="tools">
                      <div class="knowledge-dialog-content">
                        <div class="knowledge-item">
                          <el-switch v-model="webSearchSettings.enabled" @change="autoSaveSettings"></el-switch>
                          <div class="knowledge-info">
                            <div class="knowledge-name">{{ t('webSearch') }}</div>
                          </div>
                        </div>
                        <div class="knowledge-item">
                          <el-switch v-model="reasonerSettings.enabled" @change="autoSaveSettings"></el-switch>
                          <div class="knowledge-info">
                            <div class="knowledge-name">{{ t('deepThinking') }}</div>
                          </div>
                        </div>
                        <div class="knowledge-item">
                          <el-switch v-model="toolsSettings.deepsearch.enabled" @change="autoSaveSettings"></el-switch>
                          <div class="knowledge-info">
                            <div class="knowledge-name">{{ t('deepResearch') }}</div>
                          </div>
                        </div>
                      </div>
                    </el-tab-pane>
                  </el-tabs>
              </el-form>
              <el-alert
                type="info"
                :closable="false"
                class="mb-2"
              >
                <template #default>
                  <div class="alert-content">
                    {{ t('agentInfo') }}
                  </div>
                </template>
              </el-alert>
              <template #footer>
                <el-button @click="showAgentForm = false">{{ t('cancel') }}</el-button>
                <el-button 
                  type="primary" 
                  @click="saveAgent"
                  :disabled="!newAgent.name || !newAgent.system_prompt">
                  {{ t('createAgent') }}
                </el-button>
              </template>
            </el-dialog>
          </div>
        </div>
        <!-- llm tool 页面 -->
        <div v-show="activeMenu === 'llmTool'" class="page llm-tool-container">
          <div class="keybox-container">
            <!-- 磁贴网格 -->
            <div class="provider-grid">
              <!-- 已有LLM工具配置 -->
              <div class="provider-card llm-card" v-for="(tool, id) in llmTools" :key="id">
                <div class="card-header">
                  <el-switch v-model="tool.enabled" @change="autoSaveSettings"></el-switch>
                  <div class="card-actions">
                    <el-button @click="removeLLMTool(id)" type="danger" circle size="small">
                      <i class="fa-solid fa-trash"></i>
                    </el-button>
                  </div>
                </div>
                <div class="llm-content">
                  <h3 class="knowledge-info">{{ tool.name }}</h3>
                  <el-tag type="info" size="small">{{ toolTypeLabel(tool.type) }}</el-tag>
                  <p class="knowledge-desc">{{ tool.description || t('noDescription') }}</p>
                </div>
              </div>
              
              <!-- 添加新LLM工具 -->
              <div class="provider-card add-tile" @click="showLLMForm = true">
                <el-icon :size="40" color="#909399"><i class="fa-solid fa-plus"></i></el-icon>
                <div style="color: #606266; margin-top: 10px;">{{ t('addLLMTool') }}</div>
              </div>
            </div>

            <!-- 添加/编辑LLM工具对话框 -->
            <el-dialog v-model="showLLMForm" :title="editingLLM ? t('editLLMTool') : t('addLLMTool')" width="600px">
              <el-form label-position="top">
                <el-form-item :label="t('toolName')" required>
                  <el-input v-model="newLLMTool.name" :placeholder="t('toolNamePlaceholder')"/>
                </el-form-item>

                <el-form-item :label="t('interfaceType')" required>
                  <el-select 
                    v-model="newLLMTool.type" 
                    @change="handleTypeChange"
                    filterable
                    allow-create
                    :placeholder="t('selectInterfaceType')">
                    <el-option
                      v-for="type in llmInterfaceTypes"
                      :key="type.value"
                      :label="type.label"
                      :value="type.value"
                    />
                  </el-select>
                </el-form-item>

                <el-form-item :label="t('description')" required>
                  <el-input
                    v-model="newLLMTool.description"
                    type="textarea"
                    :rows="3"
                    :placeholder="t('descriptionPlaceholder')"
                  />
                </el-form-item>

                <el-form-item :label="t('baseURL')" required>
                  <el-input
                    v-model="newLLMTool.base_url"
                    :placeholder="defaultBaseURL"
                  />
                </el-form-item>

                <el-form-item :label="t('apiKey')" required>
                  <el-input
                    v-model="newLLMTool.api_key"
                    show-password
                  />
                </el-form-item>

                <el-form-item :label="t('modelName')" required>
                  <el-input
                    v-model="newLLMTool.model"
                  >
                  </el-input>
                </el-form-item>
              </el-form>

              <template #footer>
                <el-button @click="cancelLLMTool">{{ t('cancel') }}</el-button>
                <el-button 
                  type="primary" 
                  @click="saveLLMTool"
                  :disabled="!formValid">
                  {{ editingLLM ? t('save') : t('createImmediately') }}
                </el-button>
              </template>
            </el-dialog>
          </div>
        </div>

        <!---- a2a页面 ---->
        <div v-show="activeMenu === 'a2a'" class="page a2a-container">
          <div class="keybox-container">
            <div class="provider-grid">
              <div class="provider-card a2a-card" v-for="(server, url) in a2aServers" :key="url">
                <div class="card-header">
                  <template v-if="server.status === 'initializing'">
                    <el-icon class="loading-spinner">
                      <i class="fa-solid fa-spinner"></i>
                    </el-icon>
                  </template>
                  <template v-else>
                    <el-switch v-model="server.enabled" @change="autoSaveSettings"></el-switch>
                  </template>
                  <div class="card-actions">
                    <el-button @click="removeA2AServer(url)" type="danger" circle size="small">
                      <i class="fa-solid fa-trash"></i>
                    </el-button>
                  </div>
                </div>
                <div class="a2a-content">
                  <h3 class="a2a-name">{{ server.name }}</h3>
                  <p class="a2a-description">{{ server.description }}</p>
                  <div class="a2a-skills">
                    <el-tag v-for="(skill, index) in server.skills" :key="index" type="info" size="small">
                      {{ skill }}
                    </el-tag>
                  </div>
                </div>
              </div>
              <div class="provider-card add-tile" @click="showAddA2ADialog = true">
                <el-icon :size="40" color="#909399"><i class="fa-solid fa-plus"></i></el-icon>
                <div style="color: #606266; margin-top: 10px;">{{ t('addA2AServer') }}</div>
              </div>
            </div>
        
            <!-- 添加A2A服务器对话框 -->
            <el-dialog v-model="showAddA2ADialog" :title="t('addA2AServer')" width="500px" label-position="top">
              <el-form label-position="top">
                <el-form-item :label="t('A2AUrl')" required>
                  <el-input v-model="newA2AUrl" placeholder="http://127.0.0.1:5000"></el-input>
                </el-form-item>
              </el-form>
              <template #footer>
                <el-button @click="showAddA2ADialog = false">{{ t('cancel') }}</el-button>
                <el-button 
                  type="primary" 
                  @click="addA2AServer"
                  :disabled="!isValidUrl(newA2AUrl)">
                  {{ t('confirmAdd') }}
                </el-button>
              </template>
            </el-dialog>
          </div>
        </div>
        

        <div v-show="activeMenu === 'api-box'" class="page tools-container">
          <div class="keybox-container">
            <!-- 磁贴网格 -->
            <div class="provider-grid">
              <!-- 已有供应商磁贴 -->
              <div class="provider-card" v-for="(provider, index) in modelProviders" :key="provider.id">
                <div class="card-header">
                  <el-tag type="info" class="vendor-tag">{{ provider.vendor }}</el-tag>
                  <div class="card-actions">
                    <el-button
                      @click="fetchModelsForProvider(provider)"
                      type="primary"
                      circle
                      size="small"
                    >
                    <i class="fa-solid fa-magnifying-glass"></i>
                    </el-button>
                    <el-button
                      @click="removeProvider(index)"
                      type="danger"
                      circle
                      size="small"
                    >
                      <i class="fa-solid fa-trash"></i>
                    </el-button>
                  </div>
                </div>

                <div class="input-group">
                  <!-- 添加输入框标签 -->
                  <div class="input-item">
                    <label>{{ t('apiAddress') }}</label>
                    <el-input
                      v-model="provider.url"
                      :placeholder="t('apiAddressPlaceholder')"
                      @change="autoSaveSettings"
                    />
                  </div>

                  <div class="input-item">
                    <label>{{ t('apiKey') }}</label>
                    <el-input
                      v-model="provider.apiKey"
                      :placeholder="t('apiKeyPlaceholder')"
                      show-password
                      @change="autoSaveSettings"
                    />
                  </div>

                  <div class="input-item">
                    <label>{{ t('modelId') }}</label>
                    <el-input
                      v-model="provider.modelId"
                      :placeholder="t('modelIdPlaceholder')"
                      @change="autoSaveSettings"
                    />
                  </div>
                  <div class="model-container">
                    <el-select
                      v-model="provider.modelId"
                      :placeholder="t('selectModel')"
                      v-if="provider.models?.length"
                      class="model-select"
                      :placeholder="t('modelList')"
                      @change="autoSaveSettings"
                    >
                      <el-option
                        v-for="model in provider.models"
                        :key="model"
                        :label="model"
                        :value="model"
                      />
                    </el-select>
                  </div>
                </div>
              </div>
              <!-- 添加新磁贴 -->
              <div class="provider-card add-tile" @click="showAddDialog = true">
                <el-icon :size="40" color="#909399"><i class="fa-solid fa-plus"></i></el-icon>
                <div style="color: #606266; margin-top: 10px;">{{ t('addNewProvider') }}</div>
              </div>
            </div>

            <!-- 添加供应商对话框 -->
            <el-dialog
              v-model="showAddDialog"
              :title="t('addNewProvider')"
              width="500px"
              @closed="newProviderTemp = { vendor: '', url: '' }"
            >
              <el-form label-position="top">
                <el-form-item :label="t('provider')" required>
                  <el-select
                    v-model="newProviderTemp.vendor"
                    :placeholder="t('pleaseSelect')"
                    @change="handleVendorChange"
                  >
                    <el-option
                      v-for="item in vendorOptions"
                      :key="item.value"
                      :label="item.label"
                      :value="item.value"
                    />
                  </el-select>
                </el-form-item>

                <el-form-item
                  v-if="newProviderTemp.vendor === 'custom'"
                  :label="t('customURL')"
                  required
                >
                  <el-input
                    v-model="newProviderTemp.url"
                    placeholder="https://api.example.com/v1"
                  />
                </el-form-item>

                <div v-if="newProviderTemp.vendor && newProviderTemp.vendor !== 'custom'">
                  <el-alert
                    :title="t('defaultConfigInfo')"
                    type="info"
                    :closable="false"
                    class="mb-2"
                  >
                    {{ t('autoFilledDefaultAPI') }} {{ newProviderTemp.vendor }}<br>
                    {{ t('enterApiKeyThenClick') }}
                  </el-alert>
                </div>
              </el-form>

              <template #footer>
                <el-button @click="showAddDialog = false">{{ t('cancel') }}</el-button>
                <el-button
                  type="primary"
                  @click="confirmAddProvider"
                  :disabled="!validProvider"
                >
                  {{ t('confirmAdd') }}
                </el-button>
              </template>
            </el-dialog>
          </div>
        </div>
        <!-- MCP -->
        <div v-show="activeMenu === 'mcp'" class="page mcp-container">
          <div class="keybox-container">
            <!-- 磁贴网格 -->
            <div class="provider-grid">
              <div class="provider-card knowledge-card" v-for="(server, name) in mcpServers" :key="name">
                <div class="card-header">
                  <!-- 加载状态指示 -->
                  <template v-if="server.processingStatus === 'initializing'">
                    <el-icon class="loading-spinner">
                      <i class="fa-solid fa-spinner"></i>
                    </el-icon>
                  </template>
                  <template v-else>
                    <el-switch
                      :active-value="false"  
                      :inactive-value="true" 
                      v-model="server.disabled"
                      @change="autoSaveSettings"
                      class="kb-switch"
                    ></el-switch>
                  </template>
                  <div class="card-actions">
                    <el-button
                      @click="removeMCPServer(name)"
                      type="danger"
                      circle
                      size="small"
                    >
                      <i class="fa-solid fa-trash"></i>
                    </el-button>
                  </div>
                </div>
                <div class="kb-content">
                  <div class="kb-header">
                    <h3 class="kb-title">{{ name }}</h3>
                  </div>
                </div>
              </div>
        
              <!-- 添加新磁贴 -->
              <div class="provider-card add-tile" @click="showAddMCPDialog = true;updateMCPExample()">
                <el-icon :size="40" color="#909399"><i class="fa-solid fa-plus"></i></el-icon>
                <div style="color: #606266; margin-top: 10px;">{{ t('addNewMCP') }}</div>
              </div>
            </div>

            <!-- 添加MCP对话框 -->
            <el-dialog
            v-model="showAddMCPDialog"
            :title="t('addNewMCP')"
            width="600px"
            @closed="newMCPJson = ''">
            <el-form label-position="top">
              <el-form-item :label="t('serverType')">
                <el-select 
                  v-model="newMCPType" 
                  @change="updateMCPExample"
                  class="full-width-input">
                  <el-option 
                    :label="t('stdioServer')" 
                    value="stdio">
                  </el-option>
                  <el-option
                    :label="t('sseServer')"
                    value="sse">
                  </el-option>
                  <el-option
                    :label="t('wsServer')"
                    value="ws">
                  </el-option>
                </el-select>
              </el-form-item>
          
              <el-alert type="info" :closable="false" class="mb-2">
                {{ t('mcpJsonFormat') }}
                <pre class="json-example">{{ currentMCPExample }}</pre>
              </el-alert>
          
              <el-form-item :label="t('mcpJsonInput')">
                <el-input
                  v-model="newMCPJson"
                  type="textarea"
                  :rows="8"
                  :placeholder="t('mcpJsonPlaceholder')"
                  resize="none"/>
              </el-form-item>
            </el-form>
            <template #footer>
              <el-button @click="showAddMCPDialog = false">{{ t('cancel') }}</el-button>
              <el-button 
                type="primary" 
                @click="addMCPServer"
                :disabled="!newMCPJson">
                {{ t('confirmAdd') }}
              </el-button>
            </template>
          </el-dialog>          
            <el-dialog
              v-model="showMCPConfirm"
              :title="t('confirmDeleteTitle')"
              width="400px"
              @closed="deletingMCPName = null">
              <div class="confirm-content">
                <p>{{ t('confirmDeleteMCP', { name: deletingMCPName }) }}</p>
                <div class="confirm-buttons">
                  <el-button @click="showMCPConfirm = false">{{ t('cancel') }}</el-button>
                  <el-button type="danger" @click="confirmDeleteMCP">{{ t('confirm') }}</el-button>
                </div>
              </div>
            </el-dialog>
          </div>
        </div>
        <!-- logo页面 -->
        <div v-show="activeMenu === 'logo'" class="page logo-container">
          <div class="license-notice">
            <h2>开源协议声明 / Open Source License</h2>
            <div class="notice-section">
              <p class="warning-text">❗ 注意！本项目是基于AGPL协议开源的，请遵守AGPL协议，以避免不必要的法律问题！</p>
              <p class="warning-text-en">❗ Attention! This project is open source based on the AGPL agreement, please abide by the AGPL agreement to avoid unnecessary legal problems!</p>
            </div>

            <div class="contact-section">
              <h3>联系我们 / Contact</h3>
              <div class="contact-card">
                <p>商业授权咨询：
                  <a href="mailto:hst97@qq.com" class="contact-link">hst97@qq.com</a>
                </p>
                <p>Commercial License：
                  <a href="mailto:hst97@qq.com" class="contact-link">hst97@qq.com</a>
                </p>
              </div>
            </div>

            <div class="social-links">
              <div class="link-item">
                <el-icon class="logo-icon">
                  <i class="fa-brands fa-github"></i>
                </el-icon>
                <span>GitHub：</span>
                <a href="https://github.com/heshengtao/super-agent-party" 
                  target="_blank" 
                  class="social-link">
                  heshengtao/super-agent-party
                </a>
              </div>
              
              <div class="link-item">
                <el-icon>
                  <i class="fa-brands fa-bilibili"></i>
                </el-icon>
                <span>Bilibili：</span>
                <a href="https://space.bilibili.com/26978344" 
                  target="_blank" 
                  class="social-link">
                  @派酱llm-party
                </a>
              </div>

              <div class="link-item">
                <el-icon>
                  <i class="fa-brands fa-discord"></i>
                </el-icon>
                <span>discord：</span>
                <a href="https://discord.com/invite/f2dsAKKr2V" 
                  target="_blank" 
                  class="social-link">
                  @llm-party
                </a>
              </div>

              <div class="link-item">
                <el-icon>
                  <i class="fa-brands fa-qq"></i>
                </el-icon>
                <span>QQ交流群：</span>
                <span class="qq-group">931057213</span>
              </div>
            </div>

            <div class="agreement-section">
              <p>完整AGPL协议内容请访问：
                <a href="https://www.gnu.org/licenses/agpl-3.0.html" 
                  target="_blank" 
                  class="agreement-link">
                  GNU Affero General Public License v3.0
                </a>
              </p>
            </div>
          </div>
        </div>

        <!-- 工具界面 -->
        <div v-show="activeMenu === 'tools'" class="page tools-container">
          <el-form :model="toolsSettings" class="settings-form" label-position="top">
            <div class="tool-item">
              <div class="tool-header">
                <span>
                  <el-icon>
                    <i class="fa-solid fa-clock"></i>
                  </el-icon>
                  {{ t('currentTime') }}
                </span>
                <el-switch v-model="toolsSettings.time.enabled" @click.stop @change="autoSaveSettings"/>
              </div>
            </div>
            <div class="tool-item">
              <div class="tool-header">
                <span>
                  <el-icon>
                    <i class="fa-solid fa-flask"></i>
                  </el-icon>
                  {{ t('deepResearch') }}
                </span>
                <el-switch v-model="toolsSettings.deepsearch.enabled" @click.stop @change="autoSaveSettings"/>
              </div>
            </div>
            <div class="tool-item">
              <div class="tool-header">
                <span>
                  <el-icon>
                    <i class="fa-solid fa-atom"></i>
                  </el-icon>
                  {{ t('fakeInference') }}
                </span>
                <el-switch v-model="toolsSettings.inference.enabled" @click.stop @change="autoSaveSettings"/>
              </div>
            </div>
            <div class="tool-item">
              <div class="tool-header">
                <span>
                  <el-icon>
                    <i class="fa-solid fa-file-invoice-dollar"></i>
                  </el-icon>
                  {{ t('latexRenderingEnhancement') }}
                </span>
                <el-switch v-model="toolsSettings.formula.enabled" @click.stop @change="autoSaveSettings"/>
              </div>
            </div>
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('language')">
                <span>
                  <el-icon>
                    <i class="fa-solid fa-comments"></i>
                  </el-icon>
                  {{ t('languageTone') }}
                </span>
                <el-switch v-model="toolsSettings.language.enabled" @click.stop @change="autoSaveSettings"/>
              </div>
              <div class="tool-content" v-show="expandedSections.language">
                <el-form-item :label="t('assistantLanguage')" class="form-item-align">
                  <el-select
                    v-model="toolsSettings.language.language"
                    @change="autoSaveSettings"
                    class="full-width-input"
                  >
                    <!--从languageOptions中动态加载-->
                    <el-option v-for="option in languageOptions" :key="option.value" :label="option.label" :value="option.value"></el-option>
                  </el-select>
                </el-form-item>
                <el-form-item :label="t('assistantTone')" class="form-item-align">
                  <el-select
                    v-model="toolsSettings.language.tone"
                    @change="autoSaveSettings"
                    class="full-width-input"
                  >
                     <!--从toneOptions中动态加载-->
                    <el-option v-for="option in toneOptions" :key="option.value" :label="option.label" :value="option.value"></el-option>
                  </el-select>
                </el-form-item>
              </div>
            </div>
          </el-form>
        </div>

        <!-- 联网搜索界面 -->
        <div v-show="activeMenu === 'websearch'" class="page tools-container">
          <el-form :model="webSearchSettings" class="settings-form"  label-position="top">
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('webSearchConfig')">
                <div class="header-left">
                  <span>
                    <el-icon>
                      <i class="fa-solid fa-globe"></i>
                    </el-icon>
                    {{ t('webSearch') }}
                  </span>
                </div>
                <el-switch v-model="webSearchSettings.enabled" @click.stop @change="autoSaveSettings"/>
              </div>
              <div class="tool-content" v-show="expandedSections.webSearchConfig">
                <el-form-item :label="t('searchEngine')" class="form-item-align">
                  <el-select
                    v-model="webSearchSettings.engine"
                    @change="autoSaveSettings"
                    class="full-width-input"
                  >
                    <el-option label="DuckDuckGo" value="duckduckgo" ></el-option>
                    <el-option label="SearXNG" value="searxng" ></el-option>
                    <el-option label="tavily" value="tavily" ></el-option>
                  </el-select>
                </el-form-item>
                <el-form-item :label="t('webCrawling')" class="form-item-align">
                  <el-select
                    v-model="webSearchSettings.crawler"
                    @change="autoSaveSettings"
                    class="full-width-input"
                  >
                    <el-option label="Jina" value="jina" ></el-option>
                    <el-option label="Crawl4AI" value="crawl4ai" ></el-option>
                  </el-select>
                </el-form-item>
                <el-form-item :label="t('webSearchTiming')" class="form-item-align">
                  <el-select
                    v-model="webSearchSettings.when"
                    @change="autoSaveSettings"
                    class="full-width-input"
                  >
                    <el-option :label="t('beforeThinking')" value="before_thinking" ></el-option>
                    <el-option :label="t('afterThinking')" value="after_thinking" ></el-option>
                    <el-option :label="t('both')" value="both" ></el-option>
                  </el-select>
                </el-form-item>
              </div>
            </div>
            <div class="tool-item" v-show="webSearchSettings.engine === 'duckduckgo'">
              <div class="tool-header" @click="toggleSection('duckduckgoConfig')">
                <div class="header-left">
                  <span>
                    <el-icon>
                      <i class="fa-solid fa-globe"></i>
                    </el-icon>
                    DuckDuckGo
                  </span>
                </div>
              </div>
              <div class="tool-content" v-show="expandedSections.duckduckgoConfig">
                <el-form-item :label="t('resultCount')" class="form-item-align">
                  <el-slider
                    v-model="webSearchSettings.duckduckgo_max_results"
                    :min="1"
                    :max="20"
                    :step="1"
                    @input="autoSaveSettings"
                  />
                </el-form-item>
              </div>
            </div>
            <div class="tool-item" v-show="webSearchSettings.engine === 'searxng'">
              <div class="tool-header" @click="toggleSection('searxngConfig')">
                <div class="header-left">
                  <span>
                    <el-icon>
                      <i class="fa-solid fa-globe"></i>
                    </el-icon>
                    SearXNG
                  </span>
                </div>
              </div>
              <div class="tool-content" v-show="expandedSections.searxngConfig">
                <el-form-item :label="t('resultCount')" class="form-item-align">
                  <el-slider
                    v-model="webSearchSettings.searxng_max_results"
                    :min="1"
                    :max="20"
                    :step="1"
                    @input="autoSaveSettings"
                  />
                </el-form-item>
                <el-form-item :label="t('baseURL')" class="form-item-align">
                  <el-input
                    v-model="webSearchSettings.searxng_url"
                    :placeholder="t('searxngURLPlaceholder')"
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
              </div>
            </div>
            <div class="tool-item" v-show="webSearchSettings.engine === 'tavily'">
              <div class="tool-header" @click="toggleSection('tavilyConfig')">
                <div class="header-left">
                  <span>
                    <el-icon>
                      <i class="fa-solid fa-globe"></i>
                    </el-icon>
                    Tavily
                  </span>
                </div>
              </div>
              <div class="tool-content" v-show="expandedSections.tavilyConfig">
                <el-form-item :label="t('resultCount')" class="form-item-align">
                  <el-slider
                    v-model="webSearchSettings.tavily_max_results"
                    :min="1"
                    :max="20"
                    :step="1"
                    @input="autoSaveSettings"
                  />
                </el-form-item>
                <el-form-item :label="t('apiKey')" class="form-item-align">
                  <el-input
                    v-model="webSearchSettings.tavily_api_key"
                    :placeholder="t('tavilyAPIKeyPlaceholder')"
                    show-password
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
              </div>
            </div>
            <div class="tool-item" v-show="webSearchSettings.crawler === 'jina'">
              <div class="tool-header" @click="toggleSection('jinaConfig')">
                <div class="header-left">
                  <span>
                    <el-icon>
                      <i class="fa-solid fa-globe"></i>
                    </el-icon>
                    jina
                  </span>
                </div>
              </div>
              <div class="tool-content" v-show="expandedSections.jinaConfig">
                <el-form-item :label="t('apiKey')" class="form-item-align">
                  <el-input
                    v-model="webSearchSettings.jina_api_key"
                    :placeholder="t('jinaAPIKeyPlaceholder')"
                    show-password
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
              </div>
            </div>
            <div class="tool-item" v-show="webSearchSettings.crawler === 'crawl4ai'">
              <div class="tool-header" @click="toggleSection('Crawl4AiConfig')">
                <div class="header-left">
                  <span>
                    <el-icon>
                      <i class="fa-solid fa-globe"></i>
                    </el-icon>
                    Crawl4Ai
                  </span>
                </div>
              </div>
              <div class="tool-content" v-show="expandedSections.Crawl4AiConfig">
                <el-form-item :label="t('baseURL')" class="form-item-align">
                  <el-input
                    v-model="webSearchSettings.Crawl4Ai_url"
                    :placeholder="t('crawl4AiURLPlaceholder')"
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
                <el-form-item :label="t('apiKey')" class="form-item-align">
                  <el-input
                    v-model="webSearchSettings.Crawl4Ai_api_key"
                    :placeholder="t('crawl4AiAPIKeyPlaceholder')"
                    show-password
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
              </div>
            </div>
          </el-form>
        </div>
        <!-- API列表界面 -->
        <div v-show="activeMenu === 'api'" class="page tools-container">
          <el-form class="settings-form">
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('superapi')">
                  <span>
                    <el-icon>
                      <i class="fa-solid fa-link"></i>
                    </el-icon>
                    {{ t('useSuperAPI') }}
                  </span>
              </div>
              <div class="tool-content" v-show="expandedSections.superapi">
                <el-alert
                  type="info"
                  :closable="false"
                  class="mb-2"
                >
                  {{ t('superAPIInstructions') }}
                </el-alert>
                <!-- 模型名称 -->
                <el-form-item :label="t('modelName')" class="form-item-align">
                  <el-input
                    :value="'super-model'"
                    readonly
                    class="full-width-input"
                  >
                    <template #append>
                      <el-button
                        @click="copyModel"
                        class="copy-btn"
                      >
                      <i class="fa-solid fa-copy"></i>
                      </el-button>
                    </template>
                  </el-input>
                </el-form-item>

                <!-- API端点 -->
                <el-form-item :label="t('apiEndpoint')" class="form-item-align">
                  <el-input
                    :value="'http://127.0.0.1:3456/v1'"
                    readonly
                    class="full-width-input"
                  >
                    <template #append>
                      <el-button
                        @click="copyEndpoint"
                        class="copy-btn"
                      >
                      <i class="fa-solid fa-copy"></i>
                      </el-button>
                    </template>
                  </el-input>
                </el-form-item>
                <!-- 在index.html的API配置区块内添加 -->
                <el-form-item :label="t('exampleLanguage')" class="form-item-align">
                  <el-select
                    v-model="selectedCodeLang"
                    @change="autoSaveSettings"
                    class="full-width-input"
                  >
                    <el-option label="Python" value="python"></el-option>
                    <el-option label="JavaScript" value="javascript"></el-option>
                    <el-option label="cURL" value="curl"></el-option>
                  </el-select>
                </el-form-item>

                <!-- 修改index.html中的代码块结构 -->
                <div class="code-block">
                  <div class="code-header">
                    <span class="code-lang">{{ selectedCodeLang }}</span>
                    <button class="copy-button" @click.prevent="handleCopy"><i class="fa-solid fa-copy"></i></button>
                  </div>
                  <pre><code class="hljs" :class="'language-' + selectedCodeLang">{{ codeExamples[selectedCodeLang] }}</code></pre>
                </div>
              </div>
            </div>
            <div class="tool-item">
              <span>
                <el-icon>
                  <i class="fa-solid fa-globe"></i>
                </el-icon>
                {{ t('useWebmode') }}
              </span>
              <div class="browser-mode-btn-container">
                <el-button
                  class="browser-mode-btn"
                  type="primary"
                  @click="launchBrowserMode"
                  :color="browserBtnColor"
                  round
                  size="large">
                  <i class="fa-solid fa-globe" v-if="!isBrowserOpening"></i>
                  <transition name="bounce">
                    <span v-if="isBrowserOpening" class="ml-2">
                      <el-icon class="is-loading"><loading /></el-icon>
                      {{ t('launching') }}
                    </span>
                    <span v-else class="ml-2">
                      {{ t('launchBrowserMode') }}
                    </span>
                  </transition>
                </el-button>
              </div>
          </div>
          </el-form>
        </div>


        <!-- 主模型界面 -->
        <!-- 修改后的主模型界面 -->
        <div v-show="activeMenu === 'settings'" class="page tools-container">
          <el-form :model="settings" class="settings-form" label-position="top">
            <div class="tool-item">
              <!-- 基础配置（仅供应商） -->
              <div class="tool-header" @click="toggleSection('settingsBase')">
                <div class="header-left">
                  <span>
                    <el-icon>
                      <i class="fa-solid fa-microchip"></i>
                    </el-icon>
                    {{ t('basicConfiguration') }}
                  </span>
                </div>
              </div>
              <div class="tool-content" v-show="expandedSections.settingsBase">
                <el-form-item :label="t('provider')" class="form-item-align">
                  <el-select
                    v-model="settings.selectedProvider"
                    :placeholder="t('selectProvider')"
                    filterable
                    @change="selectMainProvider"
                    @visible-change="handleMainProviderVisibleChange"
                    class="full-width-input"
                  >
                    <el-option
                      v-for="provider in modelProviders"
                      :key="provider.id"
                      :label="provider.vendor"
                      :value="provider.id"
                    >
                      <div class="provider-option">
                        <span class="vendor-tag">{{ provider.vendor }}</span>
                        <span class="model-id">{{ provider.modelId }}</span>
                      </div>
                    </el-option>
                  </el-select>
                </el-form-item>
              </div>
                <el-alert
                  type="info"
                  :closable="false"
                  class="mb-2"
                >
                  <template #default>
                    <div class="alert-content">
                      {{ t('firstTimeUse') }}
                      <el-link
                        type="primary"
                        :underline="false"
                        class="font-medium"
                        @click="switchToApiBox"
                      >
                        <el-icon class="mr-1">
                          <i class="fa-solid fa-key"></i>
                        </el-icon>{{ t('keyBoxInterface') }}
                      </el-link>
                      {{ t('addProviderReturnSelect') }}
                      {{ t('mainmodelnotice') }}
                    </div>
                  </template>
                </el-alert>
            </div>
            <!-- 新增高级配置 -->
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('settingsAdvanced')">
                <div class="header-left">
                  <span>
                    <el-icon>
                      <i class="fa-solid fa-chevron-right"></i>
                    </el-icon>
                    {{ t('advancedConfiguration') }}
                  </span>
                </div>
              </div>
              <div class="tool-content" v-show="expandedSections.settingsAdvanced">
                <el-form-item :label="t('modelName')" class="form-item-align">
                  <el-input
                    v-model="settings.model"
                    :placeholder="t('modelName')"
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
                <el-form-item :label="t('baseURL')" class="form-item-align">
                  <el-input
                    v-model="settings.base_url"
                    :placeholder="t('baseURL')"
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
                <el-form-item :label="t('apiKey')" class="form-item-align">
                  <el-input
                    v-model="settings.api_key"
                    :placeholder="t('apiKey')"
                    show-password
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
                <el-form-item :label="t('temperature')" class="form-item-align">
                  <el-slider
                    v-model="settings.temperature"
                    :min="0"
                    :max="1"
                    :step="0.1"
                    @input="autoSaveSettings"
                  />
                </el-form-item>
                <el-form-item :label="t('outputLength')" class="form-item-align">
                  <el-slider
                    v-model="settings.max_tokens"
                    :min="0"
                    :max="128000"
                    :step="1024"
                    @input="autoSaveSettings"
                  />
                </el-form-item>
                <el-form-item :label="t('conversationRounds')" class="form-item-align">
                  <el-slider
                    v-model="settings.max_rounds"
                    :min="0"
                    :max="1000"
                    :step="2"
                    @input="autoSaveSettings"
                  />
                </el-form-item>
              </div>
            </div>
          </el-form>
        </div>
        <!-- 知识库页面 -->
        <div v-show="activeMenu === 'document'" class="page knowledge-base-container">
          <div class="keybox-container">
            <!-- 磁贴网格 -->
            <div class="provider-grid">
              <!-- 知识库磁贴 -->
              <div class="provider-card knowledge-card" v-for="kb in knowledgeBases" :key="kb.id">
                <div class="card-header">
                  <!-- 加载状态指示 -->
                  <template v-if="kb.processingStatus === 'processing'">
                    <el-icon class="loading-spinner">
                      <i class="fa-solid fa-spinner"></i>
                    </el-icon>
                  </template>
                  <template v-else>
                    <el-switch v-model="kb.enabled" @change="toggleKbEnabled(kb)"></el-switch>
                  </template>

                  <div class="card-actions">
                    <el-button @click="removeKnowledgeBase(kb)" type="danger"  circle size="small">
                      <i class="fa-solid fa-trash"></i>
                    </el-button>
                  </div>
                </div>

                <!-- 内容区域根据状态显示 -->
                <!-- 修改模板部分 -->
                <template v-if="kb.processingStatus !== 'processing'">
                  <div class="kb-content">
                    <div class="kb-header">
                      <h3 class="kb-title">{{ kb.name }}</h3>
                      <el-tag v-if="kb.files?.length" type="info" size="small" effect="dark">
                        {{ kb.files.length }} {{ t('files') }}
                      </el-tag>
                    </div>
                    <p class="kb-description">{{ kb.introduction || t('noDescription') }}</p>
                    <div class="kb-meta">
                      <div class="kb-meta-item">
                        <el-icon class="kb-icon">
                          <i class="fa-solid fa-file"></i>
                        </el-icon>
                        <span>{{ t('model') }}: {{ kb.model || t('default') }}</span>
                      </div>
                      <div class="kb-meta-item">
                        <el-icon class="kb-icon">
                          <i class="fa-solid fa-database"></i>
                        </el-icon>
                        <span>{{ t('segment') }}: {{ kb.chunk_size }} / {{ kb.chunk_overlap }}</span>
                      </div>
                    </div>
                  </div>
                </template>
                <div v-else class="processing-message">
                  <p>{{ t('knowledgeBaseGenerating') }}</p>
                </div>
              </div>
              <!-- 添加新知识库磁贴 -->
              <div class="provider-card add-tile" @click="showAddKbDialog = true">
                <el-icon :size="40" color="#909399">
                  <i class="fa-solid fa-plus"></i>
                </el-icon>
                <div style="color: #606266; margin-top: 10px;">{{ t('addNewKnowledgeBase') }}</div>
              </div>
            </div>

            <!-- 添加知识库对话框 -->
            <el-dialog
              v-model="showAddKbDialog"
              :title="t('addNewKnowledgeBase')"
              width="600px"
              @closed="() => {
                newKb = {
                  name: '',
                  introduction: '',
                  providerId: null,
                  model: '',
                  base_url: '',
                  api_key: '',
                  chunk_size: 1024,
                  chunk_overlap: 256,
                  chunk_k: 5
                }
              }"
            >
              <el-form label-position="top" label-width="120px">
                <el-form-item :label="t('knowledgeBaseName')" required>
                  <el-input v-model="newKb.name" :placeholder="t('enterKnowledgeBaseName')" />
                </el-form-item>

                <el-form-item :label="t('knowledgeBaseIntro')">
                  <el-input v-model="newKb.introduction" type="textarea" :placeholder="t('enterKnowledgeBaseIntro')" />
                </el-form-item>

                <el-form-item :label="t('provider')" required>
                  <el-select
                    v-model="newKb.providerId"
                    :placeholder="t('selectProvider')"
                    filterable
                    @change="selectKbProvider"
                    class="full-width-input"
                  >
                    <el-option
                      v-for="provider in modelProviders"
                      :key="provider.id"
                      :label="provider.vendor"
                      :value="provider.id"
                    >
                      <div class="provider-option">
                        <span class="vendor-tag">{{ provider.vendor }}</span>
                        <span class="model-id">{{ provider.modelId }}</span>
                      </div>
                    </el-option>
                  </el-select>
                </el-form-item>
                <el-alert type="info" :closable="false" class="mb-2">
                  <template #default>
                    <div class="alert-content">
                      {{ t('firstTimeUse') }}
                      <el-link
                        type="primary"
                        :underline="false"
                        class="font-medium"
                        @click="switchToApiBox"
                      >
                        <el-icon class="mr-1">
                          <i class="fa-solid fa-key"></i>
                        </el-icon>{{ t('keyBoxInterface') }}
                      </el-link>
                      {{ t('addProviderReturnSelect') }}
                      {{ t('addemdNotice') }}
                    </div>
                  </template>
                </el-alert>
                <el-collapse v-model="activeCollapse" class="advanced-settings">
                  <el-collapse-item name="advanced">
                    <template #title>
                      <div class="collapse-title">
                        <el-icon class="mr-2">
                          <i class="fa-solid fa-chevron-right"></i>
                        </el-icon>
                        <span class="font-medium">{{ t('advancedSettings') }}</span>
                      </div>
                    </template>
                    <el-form-item :label="t('modelName')" required>
                      <el-input
                        v-model="newKb.model"
                        :placeholder="t('modelName')"
                      />
                    </el-form-item>

                    <el-form-item :label="t('baseURL')" required>
                      <el-input
                        v-model="newKb.base_url"
                        :placeholder="t('baseURL')"
                      />
                    </el-form-item>

                    <el-form-item :label="t('apiKey')" required>
                      <el-input
                        v-model="newKb.api_key"
                        :placeholder="t('apiKey')"
                        show-password
                      />
                    </el-form-item>

                    <el-form-item :label="t('segmentSize')">
                      <el-slider
                        v-model="newKb.chunk_size"
                        :min="512"
                        :max="4096"
                        :step="512"
                        @input="autoSaveSettings"
                      />
                    </el-form-item>
                    <el-form-item :label="t('overlapSize')">
                      <el-slider
                        v-model="newKb.chunk_overlap"
                        :min="128"
                        :max="1024"
                        :step="128"
                        @input="autoSaveSettings"
                      />
                    </el-form-item>
                    <el-form-item :label="t('returnParagraphs')">
                      <el-slider
                        v-model="newKb.chunk_k"
                        :min="1"
                        :max="50"
                        :step="1"
                        @input="autoSaveSettings"
                      />
                    </el-form-item>
                  </el-collapse-item>
                </el-collapse>
              </el-form>
              <!-- 文件上传区域 -->
              <el-form-item>
                <div
                  class="drop-zone"
                  @dragover.prevent
                  @drop.prevent="handleKbDrop"
                  @click="browseKbFiles"
                >
                  <el-icon :size="50">
                    <i class="fa-solid fa-upload"></i>
                  </el-icon>
                  <p>{{ t('clickOrDrop') }}</p>
                </div>

                <!-- 紧凑型文件列表 -->
                <div class="compact-file-list" v-if="newKbFiles.length">
                  <div
                    v-for="(file, index) in newKbFiles"
                    :key="index"
                    class="compact-file-item"
                  >
                    <span class="file-name">@{{ file.name }}</span>
                    <el-button
                      @click.stop="removeKbFile(index)"
                      class="delete-icon"
                      circle
                    />
                    <i class="fa-solid fa-trash"></i>
                    </el-button>
                  </div>
                </div>
              </el-form-item>
              <template #footer>
                <el-button @click="showAddKbDialog = false">{{ t('cancel') }}</el-button>
                <el-button
                  type="primary"
                  @click="createKnowledgeBase"
                  :disabled="!newKb.name || !newKb.providerId"
                >
                  {{ t('createImmediately') }}
                </el-button>
              </template>
            </el-dialog>
          </div>
        </div>
        <div v-show="activeMenu === 'system'" class="page tools-container">
          <el-form :model="systemSettings" class="settings-form" label-position="top">
            <div class="tool-item">
              <div class="tool-header">
                <span>
                  <el-icon>
                    <i class="fa-solid fa-language"></i>
                  </el-icon>
                  {{ t('systemLanguage') }}
                </span>
              </div>
              <div class="tool-content">
                <el-form-item class="form-item-align">
                  <el-select
                    v-model="systemSettings.language"
                    @change="handleSystemLanguageChange"
                    class="full-width-input">
                    <el-option
                      v-for="option in systemlanguageOptions"
                      :key="option.value"
                      :label="option.label"
                      :value="option.value">
                    </el-option>
                  </el-select>
                </el-form-item>
              </div>
            </div>

            <div class="tool-item">
              <div class="tool-header">
                <span>
                  <el-icon>
                    <i class="fa-solid fa-brush"></i>
                  </el-icon>
                  {{ t('themeSettings') }}
                </span>
              </div>
              <div class="tool-content">
                <el-form-item class="form-item-align">
                  <el-select
                    v-model="systemSettings.theme"
                    @change="handleThemeChange"
                    class="full-width-input">
                    <el-option
                      v-for="option in themeOptions"
                      :key="option.value"
                      :label="option.label"
                      :value="option.value">
                    </el-option>
                  </el-select>
                </el-form-item>
              </div>
            </div>
          </el-form>
        </div>
        <!-- 推理模型界面 -->
        <div v-show="activeMenu === 'reasoner'" class="page tools-container">
          <el-form :model="settings" class="settings-form" label-position="top">
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('reasonerConfig')">
                <div class="header-left">
                  <span>
                    <el-icon>
                      <i class="fa-solid fa-atom"></i>
                    </el-icon>
                    {{ t('reasonerConfig') }}
                  </span>
                </div>
                <el-switch v-model="reasonerSettings.enabled" @click.stop @change="autoSaveSettings"/>
              </div>
              <div class="tool-content" v-show="expandedSections.reasonerConfig">
                <el-form-item :label="t('provider')" class="form-item-align">
                  <el-select
                    v-model="reasonerSettings.selectedProvider"
                    :placeholder="t('selectProvider')"
                    filterable
                    @change="selectReasonerProvider"
                    @visible-change="handleReasonerProviderVisibleChange"
                    class="full-width-input"
                  >
                    <el-option
                      v-for="provider in modelProviders"
                      :key="provider.id"
                      :label="provider.vendor"
                      :value="provider.id"
                    >
                      <div class="provider-option">
                        <span class="vendor-tag">{{ provider.vendor }}</span>
                        <span class="model-id">{{ provider.modelId }}</span>
                      </div>
                    </el-option>
                  </el-select>
                </el-form-item>
              </div>
              <el-alert
              type="info"
              :closable="false"
              class="mb-2"
            >
              <template #default>
                <div class="alert-content">
                  {{ t('firstTimeUse') }}
                  <el-link
                    type="primary"
                    :underline="false"
                    class="font-medium"
                    @click="switchToApiBox"
                  >
                    <el-icon class="mr-1">
                      <i class="fa-solid fa-key"></i>
                    </el-icon>{{ t('keyBoxInterface') }}
                  </el-link>
                  {{ t('addProviderReturnSelect') }}
                  {{ t('addresonerNotice') }}
                </div>
              </template>
            </el-alert>
            </div>
            <div class="tool-item">
              <div class="tool-header" @click="toggleSection('reasonerAdvanced')">
                <div class="header-left">
                  <span>
                    <el-icon>
                      <i class="fa-solid fa-chevron-right"></i>
                    </el-icon>
                    {{ t('advancedConfiguration') }}
                  </span>
                </div>
              </div>
              <div class="tool-content" v-show="expandedSections.reasonerAdvanced">
                <el-form-item :label="t('modelName')" class="form-item-align">
                  <el-input
                    v-model="reasonerSettings.model"
                    :placeholder="t('modelName')"
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
                <el-form-item :label="t('baseURL')" class="form-item-align">
                  <el-input
                    v-model="reasonerSettings.base_url"
                    :placeholder="t('baseURL')"
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
                <el-form-item :label="t('apiKey')" class="form-item-align">
                  <el-input
                    v-model="reasonerSettings.api_key"
                    :placeholder="t('apiKey')"
                    show-password
                    @input="autoSaveSettings"
                    class="full-width-input"
                  />
                </el-form-item>
                <el-form-item :label="t('temperature')" class="form-item-align">
                  <el-slider
                    v-model="reasonerSettings.temperature"
                    :min="0"
                    :max="1"
                    :step="0.1"
                    @input="autoSaveSettings"
                  />
                </el-form-item>
              </div>
            </div>
          </el-form>
        </div>
      </el-main>
    </el-container>
  </div>

  <!-- 引入Vue和Element Plus -->
  <script src="node_modules/vue/dist/vue.global.js"></script>
  <script src="node_modules/element-plus/dist/index.full.js"></script>
  <script src="node_modules/@element-plus/icons-vue/dist/index.iife.min.js"></script>
  <script src="js/renderer.js"></script>
</body>
</html>
